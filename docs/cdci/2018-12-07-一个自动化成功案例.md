##一个自动化成功案例

快速应用程序更新固然好，但只有在组织能够简单实现测试稳定的前提下

**By Mike Pfeiffer**

在现代软件开发时代，世界各地的公司都在争先发布基于客户反馈的产品更新。亚马逊、谷歌、微软和其他大公司每周更新产品应用程序，在某些情况下，甚至可能每天多次更新。

实现这一点的关键在于持续交付(CD)工作流，在这种工作方式下，任何增量更新被集中到应用程序中，并且被证明可以在任何给定时间发布到生产环境。

采用CD模型的最大挑战之一是实施一系列全面测试。自动化测试能够保证团队在将变更部署到生产环境时保持自信，不仅发布稳定，而且还非常迅速。

###在CD工作流中自动测试

在CD模型中工作，包含新功能或服务的代码变更是一系列自动化过程的开始，整个过程将验证代码并确保其能够在类生产环境中正常工作。这些变更通常流经一系列阶段，通常也被称作管道。每个阶段的自动化测试对团队能否实现快速迭代起着至关重要的作用。

###典型的****CD****工作流如下所述：

**版本控制。**应用程序开发人员将代码变更提交到版本控制仓库中。例如，某个开发团队可能正使用分布式版本控制工具(如Git)进行大型项目的协作，并且将代码提交到中央位置——公有或私有的GitHub仓库中。当要给应用程序添加新功能或服务时，开发人员可以修改代码，并将其提交到主分支，然后推送这些变更到主仓库，与团队的其他成员共享。

**自动构建与单元测试。**持续集成（CI）系统可以轮询仓库检测更改，并且在发现新代码签入时，自动构建编译二进制文件并生成诸如网页、脚本和配置文件。常见的CI系统包括Jenkins、Team City和Travis CI。自动单元测试通常在这个阶段运行，采用某个测试框架，如针对.NET的NUnit与针对Java的Junit。自动化单元测试没有外部依赖，如web服务器、数据库服务器或文件系统。整个CI构建与单元测试流程快速执行，所以如果存在问题开发者能够快速发现。

**集成测试。**在CI系统或另外编排工具的协助下，构建代码和工件可以部署到新环境或现有环境中进行开发和测试。常见的方案是在此阶段部署基础结构，如代码，以启动与所有应用程序存在依赖关系的环境。这样能够让集成测试运行以确保应用程序在部署后能够运行。例如，自动化集成测试可以确定应用程序中的所有组件，如通过web应用程序、功能访问数据库。

**功能/验收测试。**自动功能测试，同样也被成为验收测试，运行以确保应用程序适用于最终用户。同样，该阶段中的管道会启动某个类生产环境，用于分级或质量保证。从这里开始，自动化验收测试将采用某个框架如Selenium——能够控制web浏览器并使其与网页交互，以确保应用程序能够为用户正常提供服务。

**性能测试。**自动负载测试可以确保应用程序能够处理类生产环境中的活动行为。有很多的开源和商业负载测试工具可用。Apache Jmeter是款开源负载测试器，这是个常见选择，许多商业化产品，包括BlazeMeter和Hewlett Packard Enterprise的StormRunner Load，扩展了前者的功能并提供许多与CI系统集成的支持。

**发布到生产。**一旦团队对结果感到满意，就可以部署新版本应用程序到生产环境中。

在本例中有很多事务要执行。此工作流中任何需要手动执行的任务都会减慢开发过程，使每周或每日发布变得非常困难。

###测试自动化的优势

在CD管道中自动化测试能够让IT团队更快的移动，最终结果是软件能具有更高质量。

在每次应用程序源代码变更后运行自动化构建和单元测试能够立即识别问题。这能够让团队进行修复，并为开发人员提供继续在应用程序上迭代的机会。

自动测试执行只需手动完成行所有任务花费时间的小部分。集成、验收与性能测试如果通过人工，可能需要几天甚至数周时间。自动化这些测试，能够带给团队竞争优势，用更多的时间来创新和改进应用程序。

如果没有自动化性能测试，为验证性能，模拟生产环境应用程序负载是非常困难的。对于基于云、支持数千用户的应用程序来说尤其如此，这类应用程序需要动态扩展以满足独特的模式需求。

此外，考虑到测试的应用程序开发往往更可靠。例如，测试驱动的软件开发模式将确保团队对应用程序架构采用测试优先的方法。结果将是某个应用程序自己适用于自动化测试，并可能实现松耦合设计，更易维护与故障排除。

###方法与最佳实践

如果你希望走上自动化测试和构建CD管道的道路，这里有一些方法和实践可以参考。

首先，确保测试是采用项目版本控制仓库中的代码。这样能够有利于构建持续集成系统，并将其自动化。

应该将测试分类为单独的容器或类别，以便它们可以在CD管道中正确的位置执行。在管道初期执行更快速的测试会更简单。例如，首先运行单元测试以快速反馈。一旦构建和单元测试完成，开发人员就能知道他们的更改是有效的；可以在后续阶段中执行耗时更长的集成和性能测试。

为确保应用程序的可预测性和可靠性，需要自动化CD管道中的每个阶段。这是一个最佳实践，只要需要的流程或测试能够在合理时间内自动化完成，而且无须不切实际的工作量。

明智的做法是采用一种方法，以便团队中的每个人都知道如何进行。例如，测试驱动开发（TDD）要求开发人员首先编写失败单元测试。接着开始编写代码并重构应用程序，直到测试通过。TDD通常能带来显式并可预测的代码底层。

另一种方法是行为驱动开发（BDD），要求团队在编写任何代码之前，先定义应用程序的行为和规范。BDD有利于产生规范的文档，并且对应用程序的预期行为有充分的理解。

最后，验收测试驱动开发（ATDD）是编写测试的协作方法。ATDD要求团队中的每个人在编写任何代码之前了解每个功能，并且团队的精度可以准确的测量，知道所有测试都处于通过状态。

为保持竞争力，软件开发团队需要迅速采取行动，以跟上当今技术领域中的快速创新步伐。使用自动化测试实现持续交付模式，是获得与世界上一些最大的软件公司相同灵活性的好方法。

不过请注意，没有千篇一律的方法。每个应用程序都是不同的，有着自己独特的要求。如果您正在寻求快速发布新功能和服务，需要充分利用自动化的力量，并在开发和运营团队中建立协作方法。
